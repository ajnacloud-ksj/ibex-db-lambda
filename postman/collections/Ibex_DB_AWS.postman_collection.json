{
  "info": {
    "name": "Ibex DB - AWS API Gateway",
    "description": "Complete test suite for AWS API Gateway production endpoint\n\n✨ NEW: Updated to use filters array format\n\nEnvironment Options:\n- Production - Custom Domain (RECOMMENDED): https://smartlink.ajna.cloud/ibexdb\n- AWS - API Gateway Direct: https://gcmdpajl1d.execute-api.ap-south-1.amazonaws.com/dev\n\nAPI Key: McuMsuWDXo1g9zqLBBzVy3uXsIKDklGT8GbIhpyl\n\nBefore running:\n1. Select 'Production - Custom Domain' or 'AWS - API Gateway Direct' environment\n2. Ensure {{api_key}} variable is set\n3. Run requests in order\n\nKey Changes:\n- filter → filters (array format)\n- op → function (aggregations)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "LIST_TABLES",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"LIST_TABLES\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "List all tables in namespace"
      }
    },
    {
      "name": "CREATE TABLE - products",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"CREATE_TABLE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"schema\": {\n    \"fields\": {\n      \"product_id\": {\"type\": \"long\", \"required\": true},\n      \"name\": {\"type\": \"string\", \"required\": true},\n      \"category\": {\"type\": \"string\", \"required\": false},\n      \"price\": {\"type\": \"double\", \"required\": true},\n      \"stock\": {\"type\": \"integer\", \"required\": false}\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Create a new products table"
      }
    },
    {
      "name": "WRITE - Insert products",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"WRITE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"records\": [\n    {\"product_id\": 1, \"name\": \"Laptop\", \"category\": \"Electronics\", \"price\": 999.99, \"stock\": 50},\n    {\"product_id\": 2, \"name\": \"Mouse\", \"category\": \"Electronics\", \"price\": 29.99, \"stock\": 200},\n    {\"product_id\": 3, \"name\": \"Desk\", \"category\": \"Furniture\", \"price\": 299.99, \"stock\": 25}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Insert 3 products"
      }
    },
    {
      "name": "QUERY - All products",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"limit\": 100\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Query all products"
      }
    },
    {
      "name": "QUERY - With filters (NEW FORMAT)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"projection\": [\"name\", \"price\"],\n  \"filters\": [\n    {\"field\": \"price\", \"operator\": \"lte\", \"value\": 500}\n  ],\n  \"limit\": 100\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Query products with price filter (new array format)"
      }
    },
    {
      "name": "QUERY - Count all products",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"aggregations\": [\n    {\"function\": \"count\", \"field\": null, \"alias\": \"total_count\"}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Count total products (using function instead of op)"
      }
    },
    {
      "name": "QUERY - Count with filters",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"filters\": [\n    {\"field\": \"price\", \"operator\": \"lte\", \"value\": 500}\n  ],\n  \"aggregations\": [\n    {\"function\": \"count\", \"field\": null, \"alias\": \"affordable_count\"}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Count affordable products (price <= 500)"
      }
    },
    {
      "name": "QUERY - Count by category",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"aggregations\": [\n    {\"function\": \"count\", \"field\": null, \"alias\": \"product_count\"}\n  ],\n  \"group_by\": [\"category\"],\n  \"sort\": [{\"field\": \"product_count\", \"order\": \"desc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Count products grouped by category"
      }
    },
    {
      "name": "UPDATE - Single record",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"UPDATE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"updates\": {\"price\": 899.99},\n  \"filters\": [\n    {\"field\": \"product_id\", \"operator\": \"eq\", \"value\": 1}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Update laptop price (single record)"
      }
    },
    {
      "name": "UPDATE - Bulk update (multiple records)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"UPDATE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"updates\": {\"stock\": 1000},\n  \"filters\": [\n    {\"field\": \"category\", \"operator\": \"eq\", \"value\": \"Electronics\"}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Bulk update: Set stock to 1000 for all Electronics"
      }
    },
    {
      "name": "AUDIT - View all versions of Laptop",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"filters\": [\n    {\"field\": \"product_id\", \"operator\": \"eq\", \"value\": 1}\n  ],\n  \"projection\": [\"_version\", \"_timestamp\", \"name\", \"price\", \"stock\"],\n  \"sort\": [{\"field\": \"_version\", \"order\": \"asc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "View complete version history for Laptop product"
      }
    },
    {
      "name": "AUDIT - Get latest version only",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"filters\": [\n    {\"field\": \"product_id\", \"operator\": \"eq\", \"value\": 1}\n  ],\n  \"sort\": [{\"field\": \"_version\", \"order\": \"desc\"}],\n  \"limit\": 1\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Get only the current state of Laptop"
      }
    },
    {
      "name": "AUDIT - Track price changes",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"filters\": [\n    {\"field\": \"product_id\", \"operator\": \"eq\", \"value\": 1}\n  ],\n  \"projection\": [\"_timestamp\", \"price\", \"_version\"],\n  \"sort\": [{\"field\": \"_timestamp\", \"order\": \"asc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Track how Laptop price changed over time"
      }
    },
    {
      "name": "AUDIT - Count versions per product",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"aggregations\": [\n    {\"function\": \"count\", \"field\": null, \"alias\": \"version_count\"}\n  ],\n  \"group_by\": [\"name\"],\n  \"sort\": [{\"field\": \"version_count\", \"order\": \"desc\"}],\n  \"limit\": 10\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Count how many times each product was updated"
      }
    },
    {
      "name": "AUDIT - Find changes today",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"filters\": [\n    {\"field\": \"_timestamp\", \"operator\": \"gte\", \"value\": \"2025-11-14T00:00:00\"},\n    {\"field\": \"_timestamp\", \"operator\": \"lte\", \"value\": \"2025-11-14T23:59:59\"}\n  ],\n  \"projection\": [\"_timestamp\", \"_version\", \"name\", \"price\"],\n  \"sort\": [{\"field\": \"_timestamp\", \"order\": \"desc\"}],\n  \"limit\": 50\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Find all product changes made today"
      }
    },
    {
      "name": "TIME TRAVEL - Query at specific timestamp",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"as_of\": \"2025-11-14T05:32:00.000000\",\n  \"projection\": [\"_version\", \"_timestamp\", \"name\", \"price\"],\n  \"limit\": 100\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Query products as they existed at specific time"
      }
    },
    {
      "name": "DELETE - Soft delete",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"DELETE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"filters\": [\n    {\"field\": \"product_id\", \"operator\": \"eq\", \"value\": 3}\n  ],\n  \"mode\": \"soft\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Soft delete desk"
      }
    },
    {
      "name": "AUDIT - View soft-deleted products",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"include_deleted\": true,\n  \"filters\": [\n    {\"field\": \"_deleted\", \"operator\": \"eq\", \"value\": true}\n  ],\n  \"projection\": [\"name\", \"_deleted_at\", \"_timestamp\", \"price\"]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Query soft-deleted products (normally hidden)"
      }
    },
    {
      "name": "DESCRIBE_TABLE",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"DESCRIBE_TABLE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Get table schema and metadata"
      }
    },
    {
      "name": "COMPACT - Optimize files",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"COMPACT\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"force\": true,\n  \"expire_snapshots\": true,\n  \"snapshot_retention_hours\": 168\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Compact table files and expire old snapshots"
      }
    },
    {
      "name": "Query existing - users table",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"limit\": 10\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Query existing users table"
      }
    },
    {
      "name": "AUDIT - Users version history (existing data)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"filters\": [\n    {\"field\": \"name\", \"operator\": \"eq\", \"value\": \"Alice\"}\n  ],\n  \"projection\": [\"_version\", \"_timestamp\", \"name\", \"email\", \"age\"],\n  \"sort\": [{\"field\": \"_version\", \"order\": \"asc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "View Alice's complete version history from existing users table"
      }
    },
    {
      "name": "DROP TABLE",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"DROP_TABLE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"products\",\n  \"purge\": true\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Drop table (purge=true deletes data files)"
      }
    },
    {
      "name": "DROP NAMESPACE",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-api-key",
            "value": "{{api_key}}",
            "type": "default"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"DROP_NAMESPACE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}",
          "host": [
            "{{baseUrl}}"
          ]
        },
        "description": "Drop namespace (must be empty)"
      }
    }
  ]
}