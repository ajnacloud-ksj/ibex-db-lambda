{
  "info": {
    "name": "Ibex DB - FastAPI (Local)",
    "description": "Complete test suite for FastAPI local development\n\n✨ NEW: Updated to use filters array format\n\nEnvironment: FastAPI - Local Development\nBase URL: http://localhost:9000\n\nBefore running:\n1. cd docker && docker-compose up -d fastapi\n2. Select 'FastAPI - Local Development' environment\n3. Run requests in order\n\nKey Changes:\n- filter → filters (array format)\n- op → function (aggregations)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health Check",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        },
        "description": "Verify FastAPI server is running"
      }
    },
    {
      "name": "CREATE TABLE - users",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"CREATE_TABLE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"schema\": {\n    \"fields\": {\n      \"id\": {\"type\": \"long\", \"required\": true},\n      \"name\": {\"type\": \"string\", \"required\": true},\n      \"email\": {\"type\": \"string\", \"required\": false},\n      \"age\": {\"type\": \"integer\", \"required\": false}\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Create a new users table"
      }
    },
    {
      "name": "WRITE - Insert users",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"WRITE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"records\": [\n    {\"id\": 1, \"name\": \"Alice\", \"email\": \"alice@example.com\", \"age\": 30},\n    {\"id\": 2, \"name\": \"Bob\", \"email\": \"bob@example.com\", \"age\": 25},\n    {\"id\": 3, \"name\": \"Charlie\", \"email\": \"charlie@example.com\", \"age\": 35}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Insert 3 users"
      }
    },
    {
      "name": "QUERY - All users",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"limit\": 100\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Query all users"
      }
    },
    {
      "name": "QUERY - With filters (NEW FORMAT)",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"projection\": [\"name\", \"age\"],\n  \"filters\": [\n    {\"field\": \"age\", \"operator\": \"gte\", \"value\": 25},\n    {\"field\": \"age\", \"operator\": \"lte\", \"value\": 35}\n  ],\n  \"limit\": 100\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Query users with age filters (new array format)"
      }
    },
    {
      "name": "QUERY - Count all users",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"aggregations\": [\n    {\"function\": \"count\", \"field\": null, \"alias\": \"total_count\"}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Count total users (using function instead of op)"
      }
    },
    {
      "name": "QUERY - Count with filters",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"filters\": [\n    {\"field\": \"age\", \"operator\": \"gte\", \"value\": 30}\n  ],\n  \"aggregations\": [\n    {\"function\": \"count\", \"field\": null, \"alias\": \"count_over_30\"}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Count users aged 30 or older (new format)"
      }
    },
    {
      "name": "UPDATE - Single record",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"UPDATE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"updates\": {\"age\": 31},\n  \"filters\": [\n    {\"field\": \"name\", \"operator\": \"eq\", \"value\": \"Alice\"}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Update Alice's age (creates Version 2)"
      }
    },
    {
      "name": "UPDATE - Bulk update (multiple records)",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"UPDATE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"updates\": {\"email\": \"updated@example.com\"},\n  \"filters\": [\n    {\"field\": \"age\", \"operator\": \"gte\", \"value\": 30}\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Bulk update: Update email for all users aged 30+"
      }
    },
    {
      "name": "AUDIT - View all versions of a record",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"filters\": [\n    {\"field\": \"name\", \"operator\": \"eq\", \"value\": \"Alice\"}\n  ],\n  \"projection\": [\"_version\", \"_timestamp\", \"name\", \"email\", \"age\"],\n  \"sort\": [{\"field\": \"_version\", \"order\": \"asc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "View complete version history for Alice"
      }
    },
    {
      "name": "AUDIT - Get latest version only",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"filters\": [\n    {\"field\": \"name\", \"operator\": \"eq\", \"value\": \"Alice\"}\n  ],\n  \"sort\": [{\"field\": \"_version\", \"order\": \"desc\"}],\n  \"limit\": 1\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Get only the latest version of Alice's record"
      }
    },
    {
      "name": "AUDIT - Track field changes over time",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"filters\": [\n    {\"field\": \"name\", \"operator\": \"eq\", \"value\": \"Alice\"}\n  ],\n  \"projection\": [\"_timestamp\", \"age\", \"_version\"],\n  \"sort\": [{\"field\": \"_timestamp\", \"order\": \"asc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Track how Alice's age changed over time"
      }
    },
    {
      "name": "AUDIT - Count versions per user",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"aggregations\": [\n    {\"function\": \"count\", \"field\": null, \"alias\": \"version_count\"}\n  ],\n  \"group_by\": [\"name\"],\n  \"sort\": [{\"field\": \"version_count\", \"order\": \"desc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Count how many versions each user has"
      }
    },
    {
      "name": "AUDIT - Find changes in time range",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"filters\": [\n    {\"field\": \"_timestamp\", \"operator\": \"gte\", \"value\": \"2025-11-14T00:00:00\"},\n    {\"field\": \"_timestamp\", \"operator\": \"lte\", \"value\": \"2025-11-14T23:59:59\"}\n  ],\n  \"projection\": [\"_timestamp\", \"_version\", \"name\", \"age\"],\n  \"sort\": [{\"field\": \"_timestamp\", \"order\": \"desc\"}]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Find all changes made today"
      }
    },
    {
      "name": "TIME TRAVEL - Query at specific timestamp",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"as_of\": \"2025-11-14T05:32:30.000000\",\n  \"projection\": [\"_version\", \"_timestamp\", \"name\", \"age\"],\n  \"limit\": 100\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Query data as it existed at a specific point in time"
      }
    },
    {
      "name": "DELETE - Soft delete",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"DELETE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"filters\": [\n    {\"field\": \"name\", \"operator\": \"eq\", \"value\": \"Charlie\"}\n  ],\n  \"mode\": \"soft\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Soft delete Charlie"
      }
    },
    {
      "name": "AUDIT - View soft-deleted records",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"QUERY\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"include_deleted\": true,\n  \"filters\": [\n    {\"field\": \"_deleted\", \"operator\": \"eq\", \"value\": true}\n  ],\n  \"projection\": [\"name\", \"_deleted_at\", \"_timestamp\"]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Query soft-deleted records (normally hidden)"
      }
    },
    {
      "name": "LIST_TABLES",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"LIST_TABLES\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "List all tables"
      }
    },
    {
      "name": "DESCRIBE_TABLE",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"DESCRIBE_TABLE\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Get table schema and metadata"
      }
    },
    {
      "name": "COMPACT - Optimize files",
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"operation\": \"COMPACT\",\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"namespace\": \"{{namespace}}\",\n  \"table\": \"users\",\n  \"force\": true,\n  \"expire_snapshots\": true,\n  \"snapshot_retention_hours\": 168\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/database",
          "host": ["{{baseUrl}}"],
          "path": ["database"]
        },
        "description": "Compact table files and expire old snapshots"
      }
    }
  ]
}
